---
title: "Final Project - Blood Lead Levels in NYC Children"
author: "Adam Fucich, Asher Andrus, Sophia Baitzel, Anita Avila"
date: "03-14-24"
output:
  prettydoc::html_pretty:
    theme: hpster
    highlight: github
    toc: true
    toc_depth: 5
    toc_title: "Table of Contents"
---

## *Hypothesis*\
  "In Boroughs where an increased number of children tested positive for elevated blood lead levels, we anticipate that there will be higher rates of poverty."

## *Background*\
For this data we are talking about the amount of tested blood lead levels in each borough in New York City. This is important because it is concerning the total amount of blood lead levels present in children and it is also interesting to look and compare the total amount of levels in each different boroughs. According to the CDC[^1], any Blood Lead Level over micrograms per deciliter (mcg/dL) is considered toxic. Elevated Blood Lead Levels can lead to numerous negative health effects, such as brain damage, slowed developmental growth, and damage to the nervous system. According to NYC Health[^2], lead is found in old paint and that lead paint turns into dust, which is usually what is found in children. What we don’t know about yet is what makes each borough so different? Some of the boroughs are maybe  30 minutes apart from each other and they still present different total amount of blood lead levels in children. There are multiple variables in which factors why some boroughs have larger or smaller amount blood lead levels, but one major factor we determined is socioeconomic status. Children from low-income families may be at higher risk due to living conditions such as, living in older, poorly maintained housing with lead hazards, lack of access to healthcare and proper nutrition, and exposure to other environmental pollutants. We are hoping to see some correlation between the poverty levels in each borough to the amount of blood lead level in children.

[^1]: ” Centers for Disease Control and Prevention, Centers for Disease Control and Prevention, 2 Sept. 2022, www.cdc.gov/nceh/lead/prevention/health-effects.htm. 
[^2]: “Lead Poisoning.” Lead Poisoning Prevention - NYC Health, www.nyc.gov/site/doh/health/health-topics/lead-poisoning-prevention.page. Accessed 13 Mar. 2024. 


![Five NYC Boroughs](https://www.worldatlas.com/r/w768/upload/c6/23/73/shutterstock-152208935.jpg)

## *Methods*\
Our dataset provides information about the number of children in New York City that tested with elevated levels of lead in their blood by location and year. 
Every year, all children at the ages of 1 and 2 years old, living in New York City are required to get their blood lead levels tested. If they are at risk for elevated levels, they are tested up until the age of 6. The data is provided to the public by the Department of Health and Mental Hygiene, through the data.cityofnewyork.us website. The data is sorted by the year and the location, which is broken down into the area name, area ID, geography type (borough, citywide, or neighborhood), and the borough ID. The variables are broken up into columns displaying the number of children that tested within certain blood lead level ranges, measured in micrograms per deciliter (µg/dL).

```{r, echo=FALSE, include=FALSE}
knitr::opts_chunk$set(message = FALSE)
library(tidyverse)
library(ggrepel)
library(janitor)
library(googlesheets4)
#install.packages("devtools")
#install.packages("dplyr")
#install.packages("tidyr")
#install.packages("googlesheets4")
#devtools::install_github("datadotworld/data.world-r", build_vignettes = TRUE)
#install.packages(kableExtra)
devtools::install_github("karthik/wesanderson")
library(wesanderson)
library(kableExtra)
library(data.world)
library(geojsonsf)
library(broom)
library(dplyr)
library(tidyr)

Children_Blood_Lead <- download_file_as_data_frame(owner_id = "city-of-ny", dataset_id = "tnry-kwh5", file_name = "children-under-6-yrs-with-elevated-blood-lead-levels-bll-1.csv")
NYC_Poverty <- read.csv("NYC Poverty Rates - Sheet1.csv")
## NYC_Poverty2 <- read_sheet("https://docs.google.com/spreadsheets/d/1ucEkW71LBr0kOU8hBvQ3tDtSDD6RWV1B664HenJr9Y0/edit?usp=sharing")
```

## *Data Tidying*
```{r setup, message =FALSE}
Filtered_Children_Blood_Lead <- Children_Blood_Lead %>%
  select(-ends_with("_NOTES")) 

Simple_Children_Blood_Lead <- Filtered_Children_Blood_Lead %>%
  rename(BLL_5 = `Children under 6 years with elevated blood lead levels (BLL) Number BLL >=5 µg/dL`) %>%
  rename(BLL_10 = `Children under 6 years with elevated blood lead levels (BLL) Number BLL>=10 µg/dL`) %>%
  rename(BLL_15 = `Children under 6 years with elevated blood lead levels (BLL) Number BLL>=15 µg/dL`) %>%
  rename(Total_Test = `Children under 6 years with elevated blood lead levels (BLL) Number Tested`) %>%
  rename(BLL_5_ratio = `Children under 6 years with elevated blood lead levels (BLL) Rate  BLL>=5 µg/dL per 1,000 tested`) %>%
  rename(BLL_10_ratio = `Children under 6 years with elevated blood lead levels (BLL) Rate BLL>=10 µg/dL per 1,000 tested`) %>%
  rename(BLL_15_ratio = `Children under 6 years with elevated blood lead levels (BLL) Rate BLL>=15 µg/dL per 1,000 tested`) %>%
  rename(Year = `time_period`)

New_Children_Lead_Poision <- Simple_Children_Blood_Lead %>%
  transform(BLL_5 = as.numeric(BLL_5)) %>%
  transform(BLL_10 = as.numeric(BLL_10)) %>%
  transform(BLL_15 = as.numeric(BLL_15)) %>%
  transform(geo_area_id = as.numeric(geo_area_id)) %>%
  transform(borough_id = as.numeric(borough_id)) %>%
  transform(Year = as.numeric(Year)) %>%
  transform(Total_Test = as.numeric(Total_Test)) %>%
  transform(BLL_5_ratio = as.numeric(BLL_5_ratio)) %>%
  transform(BLL_10_ratio = as.numeric(BLL_10_ratio)) %>%
  transform(BLL_15_ratio = as.numeric(BLL_15_ratio))
   
New_Blood_Lead_Children <- New_Children_Lead_Poision %>%
  mutate(Total_Lead_Poisoned = (BLL_5 + BLL_10 + BLL_15)) %>%
  mutate(Total_Not_Lead_Poisioned = (Total_Test) - (BLL_5 + BLL_10 + BLL_15))

Poverty_Blood <- right_join(NYC_Poverty, New_Blood_Lead_Children, by = c("Year", "geo_area_name")) %>%
  filter(geo_type == "Borough") %>%
  mutate(Pos_Test_Rate = (Total_Lead_Poisoned/Total_Test) * 100)

```

## *Graphs* 

```{r fig.width=6, fig.height=6, fig.align='center', echo=FALSE}
## Line graph comparing total children testing positive for BBL by borough. Needs title?
New_Blood_Lead_Children %>%
  filter(geo_type == "Borough") %>%
  group_by("geo_area_name") %>%
  ggplot() +
  geom_line(aes(x = Year, y = (Total_Lead_Poisoned / 1000), color = geo_area_name), linewidth = 1.5) +
  scale_color_manual(values = wes_palette("AsteroidCity1", 5, type = "discrete")) +
  scale_x_continuous(name = "Year", breaks = seq(2005, 2016, 1)) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  scale_y_continuous(name = "Total Cases (thousands)", breaks = seq(0, 17.5, 2.5)) + 
  guides( color = guide_legend(title = "NYC Borough"))
## Do i need to ungroup here?

# Map of the 5 boroughs we could use: https://www.loumovesyou.com/wp-content/uploads/2022/11/FiveBoroughs-01.jpg

Poverty_Blood %>%
  ggplot() +
  geom_line(aes(x = Year, y = Poverty_Rate, color = geo_area_name), linewidth = 1.25) +
  scale_color_manual(values = wes_palette("AsteroidCity1", 5, type = "discrete")) +
   scale_y_continuous(breaks = seq(0, 30, 5)) +
  scale_x_continuous(breaks = seq(2005, 2016, 1)) +
  labs(x = "Year", y = "Poverty Rate", color = "Boroughs", caption = "Poverty Rates by Borough from 2005 to 2016") +
  theme_gray() +
  theme(plot.caption = element_text(hjust = .5), axis.text.x = element_text(angle = 45))

Poverty_Blood %>%
  filter(geo_type == "Borough") %>%
  ggplot()+
  geom_smooth(aes(x=Poverty_Rate,y=Total_Lead_Poisoned/1000, color = "black"))+
  labs(x ="Poverty Rate", y = "Lead Poisoning Total", caption = "Poverty Rates and Lead Poisoning")+
  theme_bw()+
  theme(plot.caption = element_text(hjust = .5), axis.text.x = element_text(angle = 30))+
  scale_x_continuous(breaks = seq(0, 30, 5))+
  scale_y_continuous(breaks = seq(0, 3.5, 0.5), limits = c(0,3))+
  theme(legend.position = "none")
  

```


## *Findings*

```{r, echo=FALSE}
  
poverty_blood_table_1 <- Poverty_Blood %>%
  select(-c("geo_area_id", "borough_id", "BLL_5", "BLL_10", "BLL_15", "geo_type", "Total_Not_Lead_Poisioned", "Total_Lead_Poisoned", "Total_Test", "BLL_5_ratio", "BLL_10_ratio", "BLL_15_ratio",)) %>%
  rename("Borough in 2005" = 'geo_area_name') %>%
  rename("Poverty Rate" = 'Poverty_Rate')%>%
  rename("Percent Positive Tests" = 'Pos_Test_Rate') %>%
  filter(Year == "2005") %>%
  select(-c("Year")) %>%
  arrange(desc(`Poverty Rate`))

poverty_blood_table_1 %>%
  kbl() %>%
  kable_styling()

poverty_blood_table_2 <- Poverty_Blood %>%
  select(-c("geo_area_id", "borough_id", "BLL_5", "BLL_10", "BLL_15", "geo_type", "Total_Not_Lead_Poisioned", "Total_Lead_Poisoned", "Total_Test", "BLL_5_ratio", "BLL_10_ratio", "BLL_15_ratio")) %>%
  rename("Borough in 2010" = 'geo_area_name') %>%
  rename("Poverty Rate" = 'Poverty_Rate')%>%
  rename("Percent Positive Tests" = 'Pos_Test_Rate') %>%
  filter(Year == "2010")%>%
  select(-c("Year")) %>%
  arrange(desc(`Poverty Rate`))

poverty_blood_table_2 %>%
  kbl() %>%
  kable_styling()
  
poverty_blood_table_3 <- Poverty_Blood %>%
  select(-c("geo_area_id", "borough_id", "BLL_5", "BLL_10", "BLL_15", "geo_type", "Total_Not_Lead_Poisioned", "Total_Lead_Poisoned", "Total_Test", "BLL_5_ratio", "BLL_10_ratio", "BLL_15_ratio")) %>%
  rename("Borough in 2015" = 'geo_area_name') %>%
  rename("Poverty Rate" = 'Poverty_Rate')%>%
  rename("Percent Positive Tests" = 'Pos_Test_Rate') %>%
  filter(Year == "2015")%>%
  select(-c("Year")) %>%
  arrange(desc(`Poverty Rate`))

poverty_blood_table_3 %>%
  kbl()%>%
  kable_styling() #%>% 
  #cell_spec("Percent Positive Tests", color = itself(`Percent Positive Tests` == 2.778493, "darkred"))


```
Our tables show that our hypothesis was not entirely correct, we anticipated that the boroughs with the most rates of poverty would also have the highest rates of elevated Blood Lead Levels in Children. If our hypothesis was correct, the Bronx would have the highest rates of positive tests due to its heightened rate of poverty.


## *Data Dictionary* \
**'geo_type'**:\
<chr> the type of geographic region (borough, citywide, or neighborhood).\
**'geo_area_id'**:\
<num> each area is given a unique ID number, with boroughs being given numbers 1-5, while neighborhoods are given 3 digit numbers, with their first number being correlated with the ID of the borough they are in.\
**'geo_area_name'**:\
<chr> the name of the borough, city, or neighborhood respectively.
**'borough_id'**:\
<num> the same as the ID number given to the boroughs in geo_area_id. This column gives every neighborhood the ID of the borough its located in.\
**'Year'**:\
<num> the year that the test data in the row is from. The years range from 2005-2016.\
**'Poverty_Rate'**:\
<num> The poverty rate of the borough in the given year.\
**'BLL_5'**:\
<num> the number of children in that year that tested as having a Blood Lead Level of equal to or over 5 micrograms per deciliter.\
**'BLL_10'**:\
<num> the number of children in that year that tested as having a Blood Lead Level of equal to or over 10 micrograms per deciliter.\
**'BLL_15'**:\
<num> the number of children in that year that tested as having a Blood Lead Level of equal to or over 15 micrograms per deciliter.\
**'Total_Test'**:\
<num> the total number of children that were tested in that area and that year.\
**'BLL_5_ratio'**:\
<num> the ratio describing the number of children that tested with a Blood Lead Level of equal to or over 5 micrograms per deciliter over total children tested that year.\
**'BLL_10_ratio'**:\
<num> the ratio describing the number of children that tested with a Blood Lead Level of equal to or over 10 micrograms per deciliter over total children tested that year.\
**'BLL_15_ratio'**:\
<num> the ratio describing the number of children that tested with a Blood Lead Level of equal to or over 15 micrograms per deciliter over total children tested that year.\
**'Total_Lead_Poisoned'**:\
<num> the combined number of children who tested positive for elevated blood lead levels. BLL_5 + BLL_10 + BLL_15 = Total_Lead_Poisoned.\
**'Total_Not_Lead_Poisoned'**:\
<num> the combined number of children who tested negative for elevated blood lead levels. Total_Test – Total_Lead_Poisoned = Total_Not_Lead_Poisoned.\
**'Pos_Test_Rate'**:\
<num> the percentage of children that tested positive out of the total number of children tested.\
```{r}

```

# *Discussion*\


# *Conclusion*\

The slight relationship between the number of children who tested with elevated lead levels in their blood and the district they live in is important to acknowledge in order to give the city a better idea of who to delegate some more funds to. The cause of elevated lead levels, such as lead piping, or lead paint, would ideally be completely removed as soon as possible, however, the areas that have a higher number of cases also have a higher rate of poverty, meaning that the tenants themselves would not have the funds to be able to remove the paint or put new pipes in the buildings. A good section of the funding would have to be delivered by the city itself, and being aware of the worst areas would be a good way of knowing where to start. Additionally, the city could also use the data to put in place an initiative to increase free testing for children in areas with higher rates of elevated lead levels, as well as giving free healthcare to those that tested positive. 